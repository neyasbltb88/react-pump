(window["webpackJsonpreact-pump"]=window["webpackJsonpreact-pump"]||[]).push([[0],{24:function(e,t,n){e.exports=n(40)},29:function(e,t,n){},30:function(e,t,n){},31:function(e,t,n){},32:function(e,t,n){},33:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){},40:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),i=n(19),s=n.n(i),r=(n(29),n(21)),c=n(10),u=n(3),l=n(6),p=n(8),d=n(7),m=n(9),h=function(e,t){var n=Math.floor(e+Math.random()*(t+1-e));return n},g=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t="",n=0;n<e;n++)t+=String.fromCharCode(h(97,122));return t},f=function e(t,n){var a=this;Object(u.a)(this,e),this.message=function(e,t){a.worker.port.postMessage(JSON.stringify({type:e,data:t}))},this.handler=function(e){try{var t=JSON.parse(e.data),n=t.type,o=t.data;"position:update"!==n&&console.log(n,o);var i=a.handlers[n];i&&i(o)}catch(s){console.log(s)}},this.worker=t,this.handlers=n,this.worker.port.addEventListener("message",this.handler,!1),this.worker.port.start()};var w=function(e,t){return function(e,t){var n,a,o=!1;return function i(){if(o)return n=arguments,void(a=this);e.apply(this,arguments),o=!0,setTimeout((function(){o=!1,n&&(i.apply(a,n),n=a=null)}),t)}}(e,t)},v=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};Object(u.a)(this,e),this.handler=function(){var e={top:window.screenY,right:window.screenX+window.outerWidth,bottom:window.screenY+window.outerHeight,left:window.screenX};t.comparePosition(e)&&(t.cb(e),t.lastPosition=e),t.autoUpdate&&(t.raf=window.requestAnimationFrame((function(){return t.handler()})))},this.cb=n,this.handler=w(this.handler,50),this.lastPosition={top:null,right:null,bottom:null,left:null},this.raf=null,this.autoUpdate=!1,this.start()}return Object(l.a)(e,[{key:"comparePosition",value:function(e){var t=this,n=!1;return Object.keys(e).forEach((function(a){e[a]!==t.lastPosition[a]&&(n=!0)})),n}},{key:"start",value:function(){this.autoUpdate=!0,this.handler()}},{key:"stop",value:function(){this.autoUpdate=!1,window.cancelAnimationFrame(this.raf)}}]),e}(),b=(n(30),n(31),function(e){var t=e.onClick,n=e.label,a=e.disabled,i=e.dense,s=e.children,r=e.color,c=s||n,u=s&&n?n:"",l="".concat(i?"Btn-dense":"Btn"),p={"--primary":r};return o.a.createElement("button",{style:r?p:{},className:l,onClick:t,disabled:a,title:u},c)}),P=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).worker=new SharedWorker("./services/worker.js"),n.messageHandler=new f(n.worker,{"pumping:connected":function(){n.onChangePumpingConnected(!0)},"pumping:disconnected":function(){n.onChangePumpingConnected(!1)},"status:pumping":function(e){n.onChangePumpingConnected(e)}}),n.state={opened:!1},n.onClick=function(){var e=(window.screen.availWidth||window.screen.width)/2-150,t=(window.screen.availHeight||window.screen.height)/2-275,a="resizable,width=".concat(300,",height=").concat(550,",left=").concat(e,",top=").concat(t,",location=no,status=no,scrollbars=no,toolbar=no,menubar=no");window.open("".concat("/react-pump","/pumping"),g(),a),n.setState({opened:!0})},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){window.main_state=this.state,window.messageHandler=this.messageHandler,this.messageHandler.message("checkStatus:pumping")}},{key:"componentDidUpdate",value:function(){window.main_state=this.state}},{key:"onChangePumpingConnected",value:function(e){this.setState({opened:e})}},{key:"render",value:function(){var e=this.state.opened,t=e?"\u041d\u0430\u0441\u043e\u0441 \u0437\u0430\u043f\u0443\u0449\u0435\u043d":"\u0417\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043d\u0430\u0441\u043e\u0441";return o.a.createElement("div",{className:"Main"},o.a.createElement(b,{onClick:this.onClick,label:t,disabled:e}))}}]),t}(a.Component),y=n(20),k=n(13),O=(n(32),function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).lastDragPosition=null,n.onMouseDown=function(e){n.lastDragPosition=e.screenY,document.addEventListener("mousemove",n.onMouseMove),document.addEventListener("mouseup",n.onMouseUp,{once:!0})},n.onMouseMove=function(e){var t=n.lastDragPosition-e.screenY;n.props.handleResize(t),n.lastDragPosition=e.screenY},n.onMouseUp=function(){document.removeEventListener("mousemove",n.onMouseMove)},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return o.a.createElement("div",{className:"PumpHandle"},o.a.createElement("img",{onMouseDown:this.onMouseDown,src:"./img/pump-handle.svg",alt:"pump-handle",className:"pump-handle-svg",draggable:"false"}))}}]),t}(a.Component));n(33);function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var E=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).worker=new SharedWorker("./services/worker.js"),n.messageHandler=new f(n.worker,{"position:update":function(e){return n.onPositionUpdate(e)},"pumped:disconnected":function(e){return n.onDisconnectedPumped(e)},"pumped:connected":function(){window.focus(),n.messageHandler.message("checkStatus:pumpeds")},"status:pumpeds":function(e){return n.autoOpenPumpeds(e)}}),n.state={lastTitle:"",pumpedSize:300,autoOpen:!0,lastPumpHeight:null,connectedSide:{left:!1,right:!1},pumpRatio:10,Pumping:{},Pumpeds:new Map,Plugged:new Map},n.onClose=function(){n.closeAllPumpeds(),n.messageHandler.message("pumping:disconnected")},n.closeAllPumpeds=function(){n.messageHandler.message("pumped:closeAll")},n.openPumped=function(e){var t=n.state.pumpedSize,a=(window.screen.availWidth||window.screen.width)-t,o=(window.screen.availHeight||window.screen.height)-t,i=e||"resizable,width=".concat(t,",height=").concat(t,",left=").concat(h(0,a),",top=").concat(h(0,o));setTimeout((function(){var e=g();window.open("".concat("/react-pump","/pumped"),e,i)}),0)},n.handleResize=function(e){window.resizeBy(0,e),window.moveBy(0,-e)},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"onPlug",value:function(e,t){var n=this;t="left"===t?"right":"left",this.setState((function(a){var o=new Map(Object(k.a)(a.Plugged));return o.has(e)&&o.get(e)===t||(o.set(e,t),n.messageHandler.message("pumped:plugged",{target:e,side:t})),{Plugged:o}}))}},{key:"onUnplug",value:function(e){var t=this;this.setState((function(n){var a=new Map(Object(k.a)(n.Plugged));return a.delete(e)&&t.messageHandler.message("pumped:unplugged",e),{Plugged:a}}))}},{key:"collisionCalc",value:function(e,t){var n=this,a=null,o=new Map(Object(k.a)(this.state.Pumpeds)),i={left:!1,right:!1};"Pumping"===e?a=t:(a=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(n,!0).forEach((function(t){Object(y.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this.state.Pumping),o.set(e,t)),o.forEach((function(e,t){var o=!1,s=!1;if(a.top<=e.bottom&&a.bottom>=e.top&&(o=!0),a.left<=e.right&&a.right>=e.left&&(s=!0),o&&s){var r=(a.right-a.left)/2+a.left-((e.right-e.left)/2+e.left)>0?"left":"right";i[r]=!0,n.onPlug(t,r)}else n.onUnplug(t)})),this.setState({connectedSide:i,Pumping:a,Pumpeds:o})}},{key:"onDisconnectedPumped",value:function(e){var t=new Map(Object(k.a)(this.state.Pumpeds)),n=this.state.Pumping;t.delete(e),this.setState({Pumpeds:t}),this.onUnplug(e),this.collisionCalc("Pumping",n)}},{key:"onPositionUpdate",value:function(e){var t=e.target,n=e.position;this.collisionCalc(t,n)}},{key:"autoOpenPumpeds",value:function(e){if(this.state.autoOpen){var t=this.state.Pumping,n=t.top,a=t.right,o=t.bottom,i=t.left,s=this.state.pumpedSize,r=["resizable,width=".concat(s,",height=").concat(s,",left=").concat(i-s+15,",top=").concat(n+o/2-s/2),"resizable,width=".concat(s,",height=").concat(s,",left=").concat(a-15,",top=").concat(n+o/2-s/2)];r[e]?this.openPumped(r[e]):this.setState({autoOpen:!1})}}},{key:"onPump",value:function(e){var t=this.state,n=t.lastPumpHeight,a=t.pumpRatio,o=e.bottom-e.top;if(null!==n&&n!==o){var i=n<o?"pump:up":"pump:down",s=Math.abs(n-o);this.messageHandler.message(i,{delta:s,ratio:a})}return o}},{key:"onPosition",value:function(e){this.messageHandler.message("position:update",{target:"Pumping",position:e});var t=this.onPump(e);this.setState({lastPumpHeight:t,Pumping:e})}},{key:"componentDidMount",value:function(){var e=this;window.pumping_state=this.state;var t=document.title;document.title="\u041d\u0430\u0441\u043e\u0441",this.setState({lastTitle:t}),window.addEventListener("beforeunload",this.onClose),this.messageHandler.message("pumping:connected"),this.posWatcher=new v((function(t){return e.onPosition(t)})),this.messageHandler.message("checkStatus:pumpeds")}},{key:"componentDidUpdate",value:function(){window.pumping_state=this.state}},{key:"componentWillUnmount",value:function(){document.title=this.state.lastTitle,this.posWatcher&&this.posWatcher.stop()}},{key:"render",value:function(){var e=this,t=this.state.connectedSide,n=Object.keys(t).map((function(e){return t[e]?o.a.createElement("img",{key:e,src:"./img/pump-tube-".concat(e,".svg"),alt:"pump-tube-".concat(e),className:"pump-tube pump-tube-".concat(e,"-svg"),draggable:"false"}):null}));return o.a.createElement("div",{className:"Pumping"},o.a.createElement("div",{className:"btn-section"},o.a.createElement(b,{onClick:function(){return e.openPumped()},label:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0448\u0430\u0440\u0438\u043a",dense:!0},o.a.createElement("img",{src:"./img/balloon-plus.svg",alt:"balloon-plus",className:"balloon-plus-svg",draggable:"false",height:"20"})),o.a.createElement(b,{onClick:function(){return e.closeAllPumpeds()},label:"\u0423\u0431\u0440\u0430\u0442\u044c \u0432\u0441\u0435 \u0448\u0430\u0440\u0438\u043a\u0438",color:"#e91e63",dense:!0},o.a.createElement("img",{src:"./img/balloon-close.svg",alt:"balloon-close",className:"balloon-close-svg",draggable:"false",height:"20"}))),o.a.createElement("div",{className:"pump"},o.a.createElement(O,{handleResize:this.handleResize}),o.a.createElement("div",{className:"pump-plunger"},o.a.createElement("img",{src:"./img/pump-plunger.svg",alt:"pump-plunger",className:"pump-plunger-svg",draggable:"false"})),o.a.createElement("div",{className:"pump-body"},o.a.createElement("img",{src:"./img/pump-body.svg",alt:"pump-body",className:"pump-body-svg",draggable:"false"}),n)))}}]),t}(a.Component),C=(n(34),function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).worker=new SharedWorker("./services/worker.js"),n.messageHandler=new f(n.worker,{"pumped:close":function(e){window.name===e&&window.close()},"pumped:closeAll":function(){window.close()},"pumped:plugged":function(e){var t=e.target,a=e.side;window.name===t&&n.onChangePlug(!0,a)},"pumped:unplugged":function(e){window.name===e&&n.onChangePlug(!1)},"pump:down":function(e){var t=e.delta,a=e.ratio;n.state.plagged&&n.onPumpDown(t,a)}}),n.state={lastTitle:"",position:{},plagged:!1,side:"",delta:0,ratio:1,runResize:!1},n.runResize=function(e){requestAnimationFrame((function(){return n.smoothResize(e)}))},n.smoothResize=function(e){var t=n.state,a=t.delta,o=t.runResize;if(!o||e){console.log("smoothResize");a-=2,window.resizeBy(2,2),window.moveBy(-1,-1),a>0?(o=!0,n.runResize(!0)):(a=0,o=!1),n.setState({delta:a,runResize:o})}},n.onClose=function(){n.messageHandler.message("pumped:disconnected",window.name)},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"onPumpDown",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.setState((function(a){return t.runResize(),{delta:a.delta+e/n,ratio:n}}))}},{key:"onChangePlug",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.setState({plagged:e,side:t})}},{key:"onPosition",value:function(e){this.messageHandler.message("position:update",{target:window.name,position:e}),this.setState({position:e})}},{key:"componentDidMount",value:function(){var e=this,t=document.title;document.title="\u0428\u0430\u0440\u0438\u043a",window.addEventListener("beforeunload",this.onClose),this.messageHandler.message("pumped:connected",window.name),this.posWatcher=new v((function(t){return e.onPosition(t)})),this.setState({lastTitle:t})}},{key:"componentWillUnmount",value:function(){document.title=this.state.lastTitle,this.posWatcher&&this.posWatcher.stop()}},{key:"render",value:function(){var e=this.state.plagged?"#e91e63":"#576d7e";return o.a.createElement("div",{className:"Pumped"},o.a.createElement("svg",{className:"baloon",xmlns:"http://www.w3.org/2000/svg",width:"223",height:"300",viewBox:"0 0 222 300",version:"1.1"},o.a.createElement("path",{fill:e,transform:"matrix(0.02344759,0,0,-0.02344759,-0.03472868,300.11723)",d:"M 4430,12789 C 3509,12730 2661,12419 1950,11881 883,11074 192,9797 36,8345 -33,7704 2,6967 136,6240 328,5201 760,4156 1358,3285 1894,2504 2583,1846 3277,1451 c 140,-79 424,-214 558,-264 215,-80 439,-136 648,-162 60,-7 111,-16 115,-19 8,-9 -15,-237 -34,-326 -35,-167 -134,-411 -198,-487 -33,-40 -33,-73 2,-105 59,-57 173,-82 372,-83 213,0 331,25 393,83 36,34 34,62 -7,116 -114,150 -225,522 -226,758 0,54 -15,47 150,68 889,116 1919,814 2751,1865 480,607 892,1332 1182,2085 466,1210 624,2521 441,3659 -214,1337 -881,2491 -1874,3242 -876,663 -1971,982 -3120,908 z"})))}}]),t}(a.Component)),S=(n(35),function(){return o.a.createElement("div",{className:"App"},o.a.createElement(r.a,{basename:"react-pump"},o.a.createElement(c.a,{path:"/",component:P,exact:!0}),o.a.createElement(c.a,{path:"/pumping",component:E}),o.a.createElement(c.a,{path:"/pumped",component:C})))});s.a.render(o.a.createElement(S,null),document.getElementById("root"))}},[[24,1,2]]]);
//# sourceMappingURL=main.cd932d6d.chunk.js.map