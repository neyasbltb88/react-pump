(window["webpackJsonpreact-pump"]=window["webpackJsonpreact-pump"]||[]).push([[0],{24:function(e,t,n){e.exports=n(39)},29:function(e,t,n){},30:function(e,t,n){},31:function(e,t,n){},32:function(e,t,n){},33:function(e,t,n){},34:function(e,t,n){},39:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),i=n(19),s=n.n(i),r=(n(29),n(21)),c=n(7),u=n(5),l=n(6),p=n(9),d=n(8),m=n(10),h=function(e,t){var n=Math.floor(e+Math.random()*(t+1-e));return n},g=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t="",n=0;n<e;n++)t+=String.fromCharCode(h(97,122));return t},f=function e(t,n){var a=this;Object(u.a)(this,e),this.message=function(e,t){a.worker.port.postMessage(JSON.stringify({type:e,data:t}))},this.handler=function(e){try{var t=JSON.parse(e.data),n=t.type,o=t.data;"position:update"!==n&&console.log(n,o);var i=a.handlers[n];i&&i(o)}catch(s){console.log(s)}},this.worker=t,this.handlers=n,this.worker.port.addEventListener("message",this.handler,!1),this.worker.port.start()};var w=function(e,t){return function(e,t){var n,a,o=!1;return function i(){if(o)return n=arguments,void(a=this);e.apply(this,arguments),o=!0,setTimeout((function(){o=!1,n&&(i.apply(a,n),n=a=null)}),t)}}(e,t)},v=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};Object(u.a)(this,e),this.handler=function(){var e={top:window.screenY,right:window.screenX+window.outerWidth,bottom:window.screenY+window.outerHeight,left:window.screenX};t.comparePosition(e)&&(t.cb(e),t.lastPosition=e),t.autoUpdate&&(t.raf=window.requestAnimationFrame((function(){return t.handler()})))},this.cb=n,this.handler=w(this.handler,50),this.lastPosition={top:null,right:null,bottom:null,left:null},this.raf=null,this.autoUpdate=!1,this.start()}return Object(l.a)(e,[{key:"comparePosition",value:function(e){var t=!1;for(var n in e)e[n]!==this.lastPosition[n]&&(t=!0);return t}},{key:"start",value:function(){this.autoUpdate=!0,this.handler()}},{key:"stop",value:function(){this.autoUpdate=!1,window.cancelAnimationFrame(this.raf)}}]),e}(),b=(n(30),n(31),function(e){var t=e.onClick,n=e.label,a=e.disabled;return o.a.createElement("button",{className:"Btn",onClick:t,disabled:a},n)}),P=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).worker=new SharedWorker("./services/worker.js"),n.messageHandler=new f(n.worker,{"pumping:connected":function(){n.onChangePumpingConnected(!0)},"pumping:disconnected":function(){n.onChangePumpingConnected(!1)},"status:pumping":function(e){n.onChangePumpingConnected(e)}}),n.state={opened:!1},n.onClick=function(){window.open("".concat("/react-pump","/pumping"),g(),"resizable"),n.setState({opened:!0})},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){window.main_state=this.state,window.messageHandler=this.messageHandler,this.messageHandler.message("checkStatus:pumping")}},{key:"componentDidUpdate",value:function(){window.main_state=this.state}},{key:"onChangePumpingConnected",value:function(e){this.setState({opened:e})}},{key:"render",value:function(){var e=this.state.opened;return o.a.createElement("div",{className:"Main"},o.a.createElement(b,{onClick:this.onClick,label:"\u0417\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043d\u0430\u0441\u043e\u0441",disabled:e}))}}]),t}(a.Component),k=n(20),y=n(12);n(32);function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var j=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).worker=new SharedWorker("./services/worker.js"),n.messageHandler=new f(n.worker,{"position:update":function(e){return n.onPositionUpdate(e)},"pumped:disconnected":function(e){return n.onDisconnectedPumped(e)}}),n.posWatcher=null,n.state={lastTitle:"",Pumping:{},Pumpeds:new Map,Plugged:new Set},n.openPumped=function(){setTimeout((function(){var e=g();window.open("".concat("/react-pump","/pumped"),e,"resizable")}),100)},n.onClose=function(){n.closeAllPumpeds(),n.messageHandler.message("pumping:disconnected")},n.closeAllPumpeds=function(){n.messageHandler.message("pumped:closeAll")},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"onPlug",value:function(e){var t=this;this.setState((function(n){var a=new Set(Object(y.a)(n.Plugged));return a.has(e)||(a.add(e),t.messageHandler.message("pumped:plugged",e)),{Plugged:a}}))}},{key:"onUnplug",value:function(e){var t=this;this.setState((function(n){var a=new Set(Object(y.a)(n.Plugged));return a.delete(e)&&t.messageHandler.message("pumped:unplugged",e),{Plugged:a}}))}},{key:"collisionCalc",value:function(e,t){var n=this,a=null,o=new Map(Object(y.a)(this.state.Pumpeds));"Pumping"===e?a=t:(a=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this.state.Pumping),o.set(e,t)),o.forEach((function(e,t){var o=!1,i=!1;a.top<=e.bottom&&a.bottom>=e.top&&(o=!0),a.left<=e.right&&a.right>=e.left&&(i=!0),o&&i?n.onPlug(t):n.onUnplug(t)})),this.setState({Pumping:a,Pumpeds:o})}},{key:"onDisconnectedPumped",value:function(e){var t=new Map(Object(y.a)(this.state.Pumpeds));t.delete(e),this.onUnplug(e),this.setState({Pumpeds:t})}},{key:"onPositionUpdate",value:function(e){var t=e.target,n=e.position;this.collisionCalc(t,n)}},{key:"onPosition",value:function(e){this.messageHandler.message("position:update",{target:"Pumping",position:e}),this.setState({Pumping:e})}},{key:"componentDidMount",value:function(){var e=this;window.pumping_state=this.state;var t=document.title;document.title="\u041d\u0430\u0441\u043e\u0441",this.setState({lastTitle:t}),window.addEventListener("beforeunload",this.onClose),this.messageHandler.message("pumping:connected"),this.posWatcher=new v((function(t){return e.onPosition(t)}))}},{key:"componentDidUpdate",value:function(){window.pumping_state=this.state}},{key:"componentWillUnmount",value:function(){document.title=this.state.lastTitle,this.posWatcher&&this.posWatcher.stop()}},{key:"render",value:function(){var e=this.state,t=e.Pumping,n=e.Plugged,a=Object.keys(t).map((function(e){return o.a.createElement("div",{key:e},e,": ",t[e])})),i=Object(y.a)(n).map((function(e){return o.a.createElement("div",{key:e},e)})),s=n.size?o.a.createElement("span",{className:"text-primary"},"(",n.size,")"):null;return o.a.createElement("div",{className:"Pumping"},o.a.createElement("div",null,"Pumping"),o.a.createElement("hr",null),o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col"},a),o.a.createElement("div",{className:"col"},"Plugged ",s,o.a.createElement("hr",null),i)),o.a.createElement("br",null),o.a.createElement(b,{onClick:this.closeAllPumpeds,label:"\u0417\u0430\u043a\u0440\u044b\u0442\u044c \u0448\u0430\u0440\u0438\u043a\u0438"}),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement(b,{onClick:this.openPumped,label:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c \u0448\u0430\u0440\u0438\u043a"}))}}]),t}(a.Component),E=(n(33),function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).worker=new SharedWorker("./services/worker.js"),n.messageHandler=new f(n.worker,{"pumped:close":function(e){window.name===e&&window.close()},"pumped:closeAll":function(){window.close()},"pumped:plugged":function(e){window.name===e&&n.onChangePlug(!0)},"pumped:unplugged":function(e){window.name===e&&n.onChangePlug(!1)}}),n.state={lastTitle:"",position:{},plagged:!1},n.onClose=function(){n.messageHandler.message("pumped:disconnected",window.name)},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"onChangePlug",value:function(e){this.setState({plagged:e})}},{key:"onPosition",value:function(e){this.messageHandler.message("position:update",{target:window.name,position:e}),this.setState({position:e})}},{key:"componentDidMount",value:function(){var e=this,t=document.title;document.title="\u0428\u0430\u0440\u0438\u043a",window.addEventListener("beforeunload",this.onClose),this.messageHandler.message("pumped:connected",window.name),this.posWatcher=new v((function(t){return e.onPosition(t)})),this.setState({lastTitle:t})}},{key:"componentWillUnmount",value:function(){document.title=this.state.lastTitle,this.posWatcher&&this.posWatcher.stop()}},{key:"render",value:function(){var e=this.state,t=e.position,n=e.plagged,a=Object.keys(t).map((function(e){return o.a.createElement("div",{key:e},e,": ",t[e])})),i=n?o.a.createElement("span",{className:"text-primary"},"(Plugged)"):null;return o.a.createElement("div",{className:"Pumped"},o.a.createElement("div",null,"Pumped: ",window.name," ",i),o.a.createElement("hr",null),a)}}]),t}(a.Component)),C=(n(34),function(){return o.a.createElement("div",{className:"App"},o.a.createElement(r.a,{basename:"react-pump"},o.a.createElement(c.a,{path:"/",component:P,exact:!0}),o.a.createElement(c.a,{path:"/pumping",component:j}),o.a.createElement(c.a,{path:"/pumped",component:E})))});s.a.render(o.a.createElement(C,null),document.getElementById("root"))}},[[24,1,2]]]);
//# sourceMappingURL=main.76bb0b0a.chunk.js.map