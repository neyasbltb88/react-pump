{"version":3,"sources":["services/rand.js","services/random-name.js","services/worker-handler.js","services/throttle.js","services/position-watcher.js","components/btn/index.js","components/btn/btn.js","pages/main/index.js","pages/main/main.js","pages/pumping/index.js","pages/pumping/pumping.js","pages/pumped/index.js","pages/pumped/pumped.js","components/app/index.js","components/app/app.js","index.js"],"names":["rand","min","max","Math","floor","random","randomName","length","name","i","String","fromCharCode","workerHandler","worker","handlers","message","type","data","port","postMessage","JSON","stringify","handler","e","parse","console","log","typeHandler","err","this","addEventListener","start","makeTrottle","func","ms","savedArgs","savedThis","isThrottled","wrapper","arguments","apply","setTimeout","throttle","positionWatcher","callback","position","top","window","screenY","right","screenX","outerWidth","bottom","outerHeight","left","comparePosition","cb","lastPosition","autoUpdate","raf","requestAnimationFrame","diff","pos","cancelAnimationFrame","Btn","props","onClick","label","disabled","className","Main","SharedWorker","messageHandler","onChangePumpingConnected","state","opened","pumpingLeft","screen","availWidth","width","pumpingWidth","pumpingTop","availHeight","height","pumpingHeight","pumpingParams","open","setState","main_state","value","Component","Pumping","onPositionUpdate","onDisconnectedPumped","focus","autoOpenPumpeds","lastTitle","pumpedSize","autoOpen","lastPumpHeight","Pumpeds","Map","Plugged","Set","onClose","closeAllPumpeds","openPumped","params","w","h","winParams","has","add","delete","target","set","forEach","pumped","vertical","horizontal","onPlug","onUnplug","collisionCalc","openedCnt","pumpedParams","msg","pumpDelta","abs","pumping_state","document","title","posWatcher","onPosition","stop","posiSpans","Object","keys","map","key","plugged","plug","pluggedCnt","size","Pumped","close","onChangePlug","delta","plagged","onPumpDown","step","move","resizeBy","moveBy","pluggedMark","App","basename","process","path","component","exact","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.2225dc83.chunk.js","sourcesContent":["const rand = (min, max) => {\r\n    let rand = Math.floor(min + Math.random() * (max + 1 - min));\r\n    return rand;\r\n}\r\n\r\nexport default rand;","import rand from './rand'\r\n\r\nconst randomName = (length = 10) => {\r\n    let name = '';\r\n    for (let i = 0; i < length; i++) {\r\n        name += String.fromCharCode(rand(97, 122));\r\n    }\r\n\r\n    return name;\r\n}\r\n\r\nexport default randomName;","export default class workerHandler {\r\n    constructor(worker, handlers) {\r\n        this.worker = worker;\r\n        this.handlers = handlers;\r\n\r\n        this.worker.port.addEventListener('message', this.handler, false);\r\n        this.worker.port.start();\r\n    }\r\n\r\n    message = (type, data) => {\r\n        this.worker.port.postMessage(JSON.stringify({ type, data }));\r\n    }\r\n\r\n    handler = (e) => {\r\n        try {\r\n            let { type, data } = JSON.parse(e.data);\r\n            if(type !== 'position:update') {\r\n                console.log(type, data);\r\n            }\r\n            \r\n\r\n            let typeHandler = this.handlers[type];\r\n            if(typeHandler) typeHandler(data);\r\n\r\n        } catch(err) { console.log(err) }\r\n    }\r\n}","function throttle(func, ms) {\r\n    let isThrottled = false,\r\n        savedArgs,\r\n        savedThis;\r\n\r\n    function wrapper() {\r\n        if (isThrottled) {\r\n            savedArgs = arguments;\r\n            savedThis = this;\r\n            return;\r\n        }\r\n\r\n        func.apply(this, arguments);\r\n        isThrottled = true;\r\n\r\n        setTimeout(function() {\r\n            isThrottled = false;\r\n            if (savedArgs) {\r\n                wrapper.apply(savedThis, savedArgs);\r\n                savedArgs = savedThis = null;\r\n            }\r\n        }, ms);\r\n    }\r\n\r\n    return wrapper;\r\n}\r\n\r\nconst makeTrottle = (func, ms) => throttle(func, ms);\r\n\r\nexport default makeTrottle;","import throttle from './throttle';\r\n\r\nexport default class positionWatcher {\r\n    constructor(callback = () => {}) {\r\n        this.cb = callback;\r\n        this.handler = throttle(this.handler, 50);\r\n        this.lastPosition = {\r\n            top: null,\r\n            right: null,\r\n            bottom: null,\r\n            left: null\r\n        };\r\n\r\n        this.raf = null;\r\n        this.autoUpdate = false;\r\n\r\n        this.start();\r\n    }\r\n\r\n    comparePosition(position) {\r\n        let diff = false;\r\n\r\n        for(let pos in position) {\r\n            if(position[pos] !== this.lastPosition[pos]) {\r\n                diff = true;\r\n            }\r\n        }\r\n\r\n        return diff;\r\n    }\r\n\r\n    handler = () => {\r\n        let position = {\r\n            top: window.screenY,\r\n            right: window.screenX + window.outerWidth,\r\n            bottom: window.screenY + window.outerHeight,\r\n            left: window.screenX\r\n        };\r\n\r\n        let compare = this.comparePosition(position);\r\n        if(compare) {\r\n            this.cb(position);\r\n            this.lastPosition = position;\r\n        }\r\n\r\n        if(this.autoUpdate) {\r\n            this.raf = window.requestAnimationFrame(() => this.handler());\r\n        }\r\n    }\r\n\r\n    start() {\r\n        this.autoUpdate = true;\r\n        this.handler();\r\n    }\r\n\r\n    stop() {\r\n        this.autoUpdate = false;\r\n        window.cancelAnimationFrame(this.raf);\r\n    }\r\n}","import Btn from './btn';\r\n\r\nexport default Btn;","import React from 'react';\r\nimport './btn.css';\r\n\r\nconst Btn = (props) => {\r\n    const { onClick, label, disabled } = props;\r\n\r\n    return <button className=\"Btn\" onClick={onClick} disabled={disabled} >{label}</button>\r\n}\r\n\r\nexport default Btn;","import Main from './main';\r\n\r\nexport default Main;","import React, { Component } from 'react';\r\nimport { randomName, workerHandler } from '../../services'\r\nimport './main.css';\r\n\r\nimport Btn from '../../components/btn';\r\n\r\nexport default class Main extends Component {\r\n\r\n    worker = new SharedWorker('./services/worker.js');\r\n\r\n    messageHandler = new workerHandler(this.worker, {\r\n        'pumping:connected': () => {\r\n            this.onChangePumpingConnected(true);\r\n        },\r\n        'pumping:disconnected': () => {\r\n            this.onChangePumpingConnected(false);\r\n        },\r\n        'status:pumping': (data) => {\r\n            this.onChangePumpingConnected(data);\r\n        }\r\n    });\r\n\r\n    state = {\r\n        opened: false,\r\n    };\r\n\r\n    componentDidMount() {\r\n        window.main_state = this.state;\r\n        window.messageHandler = this.messageHandler;\r\n\r\n        this.messageHandler.message('checkStatus:pumping');\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        window.main_state = this.state;\r\n    }\r\n\r\n    onChangePumpingConnected(value) {\r\n        this.setState({\r\n            opened: value\r\n        });\r\n    }\r\n\r\n    onClick = () => {\r\n        const { REACT_APP_DEPLOY_FOLDER } = process.env;\r\n        const DEPLOY_FOLDER = REACT_APP_DEPLOY_FOLDER ? '/' + REACT_APP_DEPLOY_FOLDER : '';\r\n\r\n        let pumpingWidth = 300;\r\n        let pumpingHeight = 550;\r\n        let screenWidth = window.screen.availWidth || window.screen.width;\r\n        let screenHeight = window.screen.availHeight || window.screen.height;\r\n\r\n        let pumpingLeft = (screenWidth / 2 ) - (pumpingWidth / 2);\r\n        let pumpingTop = (screenHeight / 2 ) - (pumpingHeight / 2);\r\n\r\n        let pumpingParams = `resizable,width=${pumpingWidth},height=${pumpingHeight},left=${pumpingLeft},top=${pumpingTop},location=no,status=no,scrollbars=no,toolbar=no,menubar=no`;\r\n\r\n        window.open(`${DEPLOY_FOLDER}/pumping`, randomName(), pumpingParams);\r\n\r\n        this.setState({\r\n            opened: true\r\n        });\r\n    }\r\n\r\n\r\n    render() {\r\n        const { opened } = this.state;\r\n        let label = opened ? 'Насос запущен' : 'Запустить насос';\r\n\r\n        return (\r\n            <div className=\"Main\">\r\n                <Btn onClick={this.onClick} label={ label } disabled={ opened }/>\r\n            </div>\r\n        )\r\n    }\r\n}","import Pumping from './pumping';\r\n\r\nexport default Pumping;","import React, { Component } from 'react';\r\nimport { rand, randomName, workerHandler, positionWatcher } from '../../services'\r\n\r\nimport Btn from '../../components/btn'\r\n\r\nimport './pumping.css';\r\n\r\nexport default class Pumping extends Component {\r\n\r\n    worker = new SharedWorker('./services/worker.js');\r\n\r\n    messageHandler = new workerHandler(this.worker, {\r\n        'position:update': (data) => this.onPositionUpdate(data),\r\n        'pumped:disconnected': (data) => this.onDisconnectedPumped(data),\r\n        'pumped:connected': () => {\r\n            window.focus();\r\n            this.messageHandler.message('checkStatus:pumpeds');\r\n        },\r\n        'status:pumpeds': (data) => this.autoOpenPumpeds(data),\r\n    });\r\n\r\n    state = {\r\n        lastTitle: '',\r\n        pumpedSize: 300,\r\n        autoOpen: true,\r\n        lastPumpHeight: null,\r\n        Pumping: {}, // Положение насоса\r\n        Pumpeds: new Map(), // Список шариков с их положениями\r\n        Plugged: new Set(), // Коллекция подключенных шариков\r\n    }\r\n\r\n    // Подключает шарик к насосу\r\n    onPlug(name) {\r\n        this.setState(state => {\r\n            let Plugged = new Set([...state.Plugged]);\r\n\r\n            // Если шарик еще не был подключен, подключаем и ведомляем\r\n            if(!Plugged.has(name)) {\r\n                Plugged.add(name);\r\n                this.messageHandler.message('pumped:plugged', name);\r\n            } \r\n            \r\n            return { Plugged };\r\n        });\r\n    }\r\n\r\n    // Отключает шарик от насоса\r\n    onUnplug(name) {\r\n        this.setState(state => {\r\n            let Plugged = new Set([...state.Plugged]);\r\n\r\n            // Если delete вернет true, значит шарик был подключен, \r\n            // а теперь отключился, значит уведомляем\r\n            if(Plugged.delete(name)) {\r\n                this.messageHandler.message('pumped:unplugged', name);\r\n            } \r\n            \r\n            return { Plugged };\r\n        });\r\n    }\r\n\r\n    // Рассчитывает столкновения(подключения) насоса и шариков\r\n    collisionCalc(target, position) {\r\n        let Pumping = null;\r\n        let Pumpeds = new Map([...this.state.Pumpeds]);\r\n\r\n        // Если изменилось положение насоса\r\n        if(target === 'Pumping') {\r\n            // Запомним новое положение насоса\r\n            Pumping = position;\r\n\r\n        // Если изменилось положение шарика\r\n        } else {\r\n            // Получим положение насоса\r\n            Pumping = {...this.state.Pumping};\r\n            // Обновим изменившееся положение шарика\r\n            Pumpeds.set(target, position);\r\n        }\r\n\r\n        // Сверяем положение насоса с шариками\r\n        Pumpeds.forEach((pumped, name) => {\r\n            let vertical = false;\r\n            let horizontal = false;\r\n\r\n            if(Pumping.top <= pumped.bottom && Pumping.bottom >= pumped.top) { vertical = true; }\r\n            if(Pumping.left <= pumped.right && Pumping.right >= pumped.left) { horizontal = true; }\r\n\r\n            if(vertical && horizontal) {\r\n                this.onPlug(name);\r\n            } else {\r\n                this.onUnplug(name);\r\n            }\r\n        });\r\n\r\n        // Сохраним изменения положений\r\n        this.setState({\r\n            Pumping,\r\n            Pumpeds\r\n        });\r\n    }\r\n\r\n    // Обрабатывает дисконнект шарика\r\n    onDisconnectedPumped(data) {\r\n        let Pumpeds = new Map([...this.state.Pumpeds]);\r\n        Pumpeds.delete(data);\r\n        this.onUnplug(data);\r\n\r\n        this.setState({\r\n            Pumpeds\r\n        });\r\n    }\r\n\r\n    // Обрабатывает изменение размеров/позиций насоса и шариков\r\n    onPositionUpdate(data) {\r\n        let { target, position } = data;\r\n        this.collisionCalc(target, position);\r\n    }\r\n\r\n    // Обрабатывает закрытие окна насоса\r\n    onClose = () => {\r\n        this.closeAllPumpeds();\r\n\r\n        this.messageHandler.message('pumping:disconnected');\r\n    }\r\n\r\n    // Отправляет команду закрытия всех шариков\r\n    closeAllPumpeds = () => {\r\n        this.messageHandler.message('pumped:closeAll');\r\n    }\r\n\r\n    // Открывает новый шарик\r\n    openPumped = (params) => {\r\n        const { REACT_APP_DEPLOY_FOLDER } = process.env;\r\n        const DEPLOY_FOLDER = REACT_APP_DEPLOY_FOLDER ? '/' + REACT_APP_DEPLOY_FOLDER : '';\r\n\r\n        let { pumpedSize } = this.state;\r\n        let screenWidth = window.screen.availWidth || window.screen.width;\r\n        let screenHeight = window.screen.availHeight || window.screen.height;\r\n\r\n        let w = screenWidth - pumpedSize;\r\n        let h = screenHeight - pumpedSize;\r\n\r\n        let winParams = params ? params : `resizable,width=${pumpedSize},height=${pumpedSize},left=${rand(0, w)},top=${rand(0, h)}`;\r\n\r\n        setTimeout(() => {\r\n            let name = randomName();\r\n            window.open(`${DEPLOY_FOLDER}/pumped`, name, winParams);\r\n        }, 0);\r\n    }\r\n\r\n    // Автоматически открывает 2 шарика слева и справа от насоса\r\n    autoOpenPumpeds(openedCnt) {\r\n        if(!this.state.autoOpen) return;\r\n\r\n        let { top, right, bottom, left } = this.state.Pumping;\r\n        let { pumpedSize } = this.state;\r\n\r\n        let pumpedParams = [\r\n            `resizable,width=${pumpedSize},height=${pumpedSize},left=${left - pumpedSize + 15},top=${top + (bottom / 2) - (pumpedSize / 2)}`,\r\n            `resizable,width=${pumpedSize},height=${pumpedSize},left=${right - 15},top=${top + (bottom / 2) - (pumpedSize / 2)}`\r\n        ];\r\n\r\n        if(pumpedParams[openedCnt]) {\r\n            this.openPumped(pumpedParams[openedCnt]);\r\n        } else {\r\n            this.setState({\r\n                autoOpen: false\r\n            });\r\n        }\r\n    }\r\n\r\n    // Обрабатывает изменение положения насоса\r\n    onPosition(position) {\r\n        this.messageHandler.message('position:update', {target: 'Pumping', position});\r\n\r\n        let { lastPumpHeight } = this.state;\r\n        let height = position.bottom - position.top;\r\n        if(lastPumpHeight !== null && lastPumpHeight !== height) {\r\n            let msg = (lastPumpHeight < height) ? 'pump:up' : 'pump:down';\r\n            let pumpDelta = Math.abs(lastPumpHeight - height);\r\n            this.messageHandler.message(msg, pumpDelta);\r\n\r\n            lastPumpHeight = height;\r\n        } else if(lastPumpHeight === null) {\r\n            lastPumpHeight = height;\r\n        }\r\n\r\n        this.setState({\r\n            lastPumpHeight,\r\n            Pumping: position\r\n        });\r\n    }\r\n\r\n    componentDidMount() {\r\n        window.pumping_state = this.state;\r\n\r\n        let lastTitle = document.title;\r\n        document.title = 'Насос';\r\n\r\n        this.setState({\r\n            lastTitle\r\n        });\r\n\r\n        window.addEventListener('beforeunload', this.onClose);\r\n        this.messageHandler.message('pumping:connected');\r\n\r\n        this.posWatcher = new positionWatcher(pos => this.onPosition(pos));\r\n\r\n        // Запрос количества открытых шариков\r\n        this.messageHandler.message('checkStatus:pumpeds');\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        window.pumping_state = this.state;\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        document.title = this.state.lastTitle;\r\n        this.posWatcher && this.posWatcher.stop();\r\n    }\r\n    \r\n    render() {\r\n        const { Pumping, Plugged } = this.state;\r\n        let posiSpans = Object.keys(Pumping).map(pos => <div key={pos}>{ pos }: { Pumping[pos] }</div>);\r\n        let plugged = [...Plugged].map(plug => <div key={plug}>{ plug }</div>);\r\n        let pluggedCnt = Plugged.size ? <span className=\"text-primary\">({ Plugged.size })</span> : null;\r\n\r\n        return (\r\n            <div className=\"Pumping\">\r\n                <div>Pumping</div>\r\n                <hr/>\r\n\r\n                <div className=\"row\">\r\n                    <div className=\"col\">{posiSpans}</div>\r\n                    <div className=\"col\">\r\n                        Plugged { pluggedCnt }\r\n                        <hr/>\r\n                        { plugged }\r\n                    </div>\r\n                </div>\r\n\r\n                <br />\r\n                <Btn onClick={this.closeAllPumpeds} label=\"Закрыть шарики\"></Btn>\r\n                <br />\r\n                <br />\r\n                <Btn onClick={() => this.openPumped()} label=\"Открыть шарик\"></Btn>\r\n            </div>\r\n        )\r\n    }\r\n}","import Pumped from './pumped';\r\n\r\nexport default Pumped;","import React, { Component } from 'react';\r\nimport { workerHandler, positionWatcher } from '../../services'\r\n\r\nimport './pumped.css';\r\n\r\nexport default class Pumped extends Component{\r\n\r\n    worker = new SharedWorker('./services/worker.js');\r\n\r\n    messageHandler = new workerHandler(this.worker, {\r\n        'pumped:close': (name) => {\r\n            if(window.name === name) window.close();\r\n        },\r\n        'pumped:closeAll': () => {\r\n            window.close();\r\n        },\r\n        'pumped:plugged': (name) => {\r\n            if(window.name === name) this.onChangePlug(true);\r\n        },\r\n        'pumped:unplugged': (name) => {\r\n            if(window.name === name) this.onChangePlug(false);\r\n        },\r\n        'pump:down': (delta) => {\r\n            if(this.state.plagged) this.onPumpDown(delta);\r\n        }\r\n    });\r\n\r\n    state = {\r\n        lastTitle: '',\r\n        position: {},\r\n        plagged: false,\r\n    }\r\n\r\n    onPumpDown(delta) {\r\n        let ratio = 5;\r\n        let step = delta / ratio;\r\n        let move = -step / 2;\r\n        \r\n        window.resizeBy(step, step);\r\n        window.moveBy(move, move);\r\n    }\r\n\r\n    onChangePlug(value) {\r\n        this.setState({\r\n            plagged: value\r\n        });\r\n    }\r\n\r\n    onPosition(position) {\r\n        this.messageHandler.message('position:update', {target: window.name, position});\r\n        this.setState({\r\n            position\r\n        })\r\n    }\r\n\r\n    onClose = () => {\r\n        this.messageHandler.message('pumped:disconnected', window.name);\r\n    }\r\n\r\n    componentDidMount() {\r\n        let lastTitle = document.title;\r\n        document.title = 'Шарик';\r\n\r\n        window.addEventListener('beforeunload', this.onClose);\r\n\r\n        this.messageHandler.message('pumped:connected', window.name);\r\n\r\n        this.posWatcher = new positionWatcher(pos => this.onPosition(pos));\r\n\r\n        this.setState({\r\n            lastTitle\r\n        });\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        document.title = this.state.lastTitle;\r\n\r\n        this.posWatcher && this.posWatcher.stop();\r\n    }\r\n\r\n    render() {\r\n        const { position, plagged } = this.state;\r\n        let posiSpans = Object.keys(position).map(pos => <div key={pos}>{ pos }: { position[pos] }</div>);\r\n        let pluggedMark = plagged ? <span className=\"text-primary\">(Plugged)</span> : null;\r\n\r\n        return (\r\n            <div className=\"Pumped\">\r\n                <div>Pumped: {window.name} { pluggedMark }</div>\r\n                <hr/>\r\n                {posiSpans}\r\n            </div>\r\n        )\r\n    }\r\n}","import App from './app'\r\n\r\nexport default App","import React from 'react';\nimport { BrowserRouter as Router, Route } from 'react-router-dom';\n\nimport Main from '../../pages/main';\nimport Pumping from '../../pages/pumping';\nimport Pumped from '../../pages/pumped';\n\nimport './app.css';\n\nconst App = () => {\n    const { REACT_APP_DEPLOY_FOLDER } = process.env;\n    \n    return (\n        <div className=\"App\" >\n            <Router basename={REACT_APP_DEPLOY_FOLDER}>\n                <Route path={`/`} component={ Main } exact/>\n\n                <Route path={`/pumping`} component={ Pumping }/>\n\n                <Route path={`/pumped`} component={ Pumped }/>\n            </Router>\n        </div>\n    )\n}\n\nexport default App;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './components/app';\n\nReactDOM.render( <App / > , document.getElementById('root'));"],"sourceRoot":""}